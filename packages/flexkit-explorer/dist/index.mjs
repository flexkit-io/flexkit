import { SquarePlay, ChevronsRight, ChevronsLeft } from 'lucide-react';
import { useMemo, useState, useRef, useEffect, Children, useCallback, Fragment as Fragment$1 } from 'react';
import { createGraphiQLFetcher } from '@graphiql/toolkit';
import { useConfig, ResizablePanelGroup, ResizablePanel, Tabs, TabsList, TabsTrigger, Tooltip as Tooltip$1, TooltipTrigger, Button, TooltipContent, Separator, TabsContent, ScrollArea, ScrollBar, ResizableHandle } from '@flexkit/studio';
import { GraphiQLProvider, useEditorContext, useExecutionContext, useSchemaContext, useStorageContext, usePluginContext, useCopyQuery, useMergeQuery, usePrettifyEditors, useTheme, useDragResize, ToolbarButton, PrettifyIcon, MergeIcon, CopyIcon, Tooltip, UnStyledButton, PlusIcon, Tabs as Tabs$1, Tab, QueryEditor, ExecuteButton, ChevronUpIcon, ChevronDownIcon, VariableEditor, HeaderEditor, Spinner, ResponseEditor, Dialog, ButtonGroup, Button as Button$1, isMacOs } from '@graphiql/react';
import { jsx, Fragment, jsxs } from 'react/jsx-runtime';
import '@graphiql/react/dist/style.css';

var Qe=Object.defineProperty;var R=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var oe=(t,l,a)=>l in t?Qe(t,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[l]=a,se=(t,l)=>{for(var a in l||(l={}))le.call(l,a)&&oe(t,a,l[a]);if(R)for(var a of R(l))re.call(l,a)&&oe(t,a,l[a]);return t};var ne=(t,l)=>{var a={};for(var r in t)le.call(t,r)&&l.indexOf(r)<0&&(a[r]=t[r]);if(t!=null&&R)for(var r of R(t))l.indexOf(r)<0&&re.call(t,r)&&(a[r]=t[r]);return a};var de=(t,l,a)=>new Promise((r,f)=>{var u=h=>{try{c(a.next(h));}catch(p){f(p);}},s=h=>{try{c(a.throw(h));}catch(p){f(p);}},c=h=>h.done?r(h.value):Promise.resolve(h.value).then(u,s);c((a=a.apply(t,l)).next());});function N(U){var v=U,{dangerouslyAssumeSchemaIsValid:t,confirmCloseTab:l,defaultQuery:a,defaultTabs:r,externalFragments:f,fetcher:u,getDefaultFieldNames:s,headers:c,inputValueDeprecation:h,introspectionQueryName:p,maxHistoryLength:b,onEditOperationName:A,onSchemaChange:I,onTabChange:O,onTogglePluginVisibility:S,operationName:g,plugins:J,query:d,response:y,schema:z,schemaDescription:L,shouldPersistHeaders:T,storage:P,validationRules:x,variables:G,visiblePlugin:D,defaultHeaders:F}=v,H=ne(v,["dangerouslyAssumeSchemaIsValid","confirmCloseTab","defaultQuery","defaultTabs","externalFragments","fetcher","getDefaultFieldNames","headers","inputValueDeprecation","introspectionQueryName","maxHistoryLength","onEditOperationName","onSchemaChange","onTabChange","onTogglePluginVisibility","operationName","plugins","query","response","schema","schemaDescription","shouldPersistHeaders","storage","validationRules","variables","visiblePlugin","defaultHeaders"]);var M;if(typeof u!="function")throw new TypeError("The `GraphiQL` component requires a `fetcher` function to be passed as prop.");return jsx(GraphiQLProvider,{getDefaultFieldNames:s,dangerouslyAssumeSchemaIsValid:t,defaultQuery:a,defaultHeaders:F,defaultTabs:r,externalFragments:f,fetcher:u,headers:c,inputValueDeprecation:h,introspectionQueryName:p,maxHistoryLength:b,onEditOperationName:A,onSchemaChange:I,onTabChange:O,onTogglePluginVisibility:S,plugins:J,visiblePlugin:D,operationName:g,query:d,response:y,schema:z,schemaDescription:L,shouldPersistHeaders:T,storage:P,validationRules:x,variables:G,children:jsx(Tt,se({confirmCloseTab:l,showPersistHeadersSettings:T!==!1,disableTabs:(M=H.disableTabs)!=null?M:!1,forcedTheme:H.forcedTheme},H))})}N.Toolbar=pe;N.Footer=be;var yt=["light","dark","system"],w="graphiql-session-tab-";function Tt(t){var Z,ee,te,ae;let l=(Z=t.isHeadersEditorEnabled)!=null?Z:!0,a=useEditorContext({nonNull:!0}),r=useExecutionContext({nonNull:!0});useSchemaContext({nonNull:!0});let u=useStorageContext(),s=usePluginContext(),[c,h]=useState(!1),p=useRef(null),b=useMemo(()=>t.forcedTheme&&yt.includes(t.forcedTheme)?t.forcedTheme:void 0,[t.forcedTheme]),A=useCopyQuery({onCopyQuery:t.onCopyQuery}),I=useMergeQuery(),O=usePrettifyEditors(),{theme:S,setTheme:g}=useTheme(t.defaultTheme);useEffect(()=>{b==="system"?g(null):(b==="light"||b==="dark")&&g(b);},[b,g]),useEffect(()=>{s==null||s.setVisiblePlugin(s.plugins[0]);},[s]);useDragResize({direction:"horizontal",storageKey:"editorFlex"});let d=useDragResize({defaultSizeRelation:3,direction:"vertical",initiallyHidden:(()=>{if(!(t.defaultEditorToolsVisibility==="variables"||t.defaultEditorToolsVisibility==="headers"))return typeof t.defaultEditorToolsVisibility=="boolean"?t.defaultEditorToolsVisibility?void 0:"second":a.initialVariables||a.initialHeaders?void 0:"second"})(),sizeThresholdSecond:60,storageKey:"secondaryEditorFlex"}),[y,z]=useState(()=>t.defaultEditorToolsVisibility==="variables"||t.defaultEditorToolsVisibility==="headers"?t.defaultEditorToolsVisibility:!a.initialVariables&&a.initialHeaders&&l?"headers":"variables"),[L,T]=useState(null),[P,x]=useState(null),G=Children.toArray(t.children),D=(ae=G.find(i=>fe(i,N.Toolbar)))!=null?ae:jsxs(Fragment,{children:[jsx(ToolbarButton,{onClick:O,label:"Prettify query (Shift-Ctrl-P)",children:jsx(PrettifyIcon,{className:"fk-w-8 fk-h-8 fk-block","aria-hidden":"true"})}),jsx(ToolbarButton,{onClick:I,label:"Merge fragments into query (Shift-Ctrl-M)",children:jsx(MergeIcon,{className:"graphiql-toolbar-icon","aria-hidden":"true"})}),jsx(ToolbarButton,{onClick:A,label:"Copy query (Shift-Ctrl-C)",children:jsx(CopyIcon,{className:"graphiql-toolbar-icon","aria-hidden":"true"})}),(ee=t.toolbar)==null?void 0:ee.additionalContent,((te=t.toolbar)==null?void 0:te.additionalComponent)&&jsx(t.toolbar.additionalComponent,{})]}),F=G.find(i=>fe(i,N.Footer)),H=useCallback(()=>{try{u==null||u.clear(),x("success");}catch(i){x("error");}},[u]),U=useCallback(i=>{a.setShouldPersistHeaders(i.currentTarget.dataset.value==="true");},[a]),v=useCallback(i=>{let n=i.currentTarget.dataset.theme;g(n||null);},[g]),M=()=>{a.addTab();},Te=i=>{a.moveTab(i);};useCallback(i=>{T(i.currentTarget.dataset.value);},[]);let ve=useCallback(i=>{var ie;let n=s,k=Number(i.currentTarget.dataset.index);if(!n)return;let Q=(ie=n.plugins.find((qt,He)=>k===He))!=null?ie:null;if(Q===n.visiblePlugin){n.setVisiblePlugin(null);return}n.setVisiblePlugin(Q);},[s]),Y=useCallback(i=>{d.hiddenElement==="second"&&d.setHiddenElement(null),z(i.currentTarget.dataset.name);},[d]),ke=useCallback(()=>{d.setHiddenElement(d.hiddenElement==="second"?null:"second");},[d]),Ee=useCallback(i=>{i||T(null);},[]),Ce=useCallback(i=>{i||(T(null),x(null));},[]),Ne=jsx(Tooltip,{label:"Add tab",children:jsx(UnStyledButton,{type:"button",className:"graphiql-tab-add",onClick:M,"aria-label":"Add tab",children:jsx(PlusIcon,{"aria-hidden":"true"})})}),Se=t.className?` ${t.className}`:"",$=t.confirmCloseTab,Pe=useCallback(i=>de(this,null,function*(){let n=i.currentTarget.previousSibling,k=Number(n.id.replace(w,""));(!$||(yield $(k)))&&(a.activeTabIndex===k&&r.stop(),a.closeTab(k));}),[$,a,r]),xe=useCallback(i=>{let n=Number(i.currentTarget.id.replace(w,""));r.stop(),a.changeTab(n);},[a,r]);return jsx(Tooltip.Provider,{children:jsxs("div",{className:`graphiql-container${Se}`,children:[jsxs(ResizablePanelGroup,{autoSaveId:"explorer",direction:"horizontal",className:"fk-h-full fk-max-h-full",children:[jsx(ResizablePanel,{collapsible:!0,collapsedSize:3,minSize:10,onCollapse:()=>{h(!0);},onExpand:()=>{h(!1);},ref:p,children:jsx("div",{className:"fk-flex fk-w-full fk-h-full fk-pb-6",children:jsxs(Tabs,{className:"fk-w-full",defaultValue:s==null?void 0:s.plugins[0].title,children:[jsxs("div",{className:`fk-flex fk-items-center fk-py-1 ${c?"":"fk-px-4"}`,children:[jsx(TabsList,{className:c?"fk-hidden":"",children:s==null?void 0:s.plugins.map((i,n)=>{let Q=`${i===s.visiblePlugin?"Hide":"Show"} ${i.title}`;return jsx(TabsTrigger,{"aria-label":Q,className:"fk-text-muted-foreground","data-index":n,onClick:ve,value:i.title,children:jsx(i.icon,{"aria-hidden":"true"})},i.title)})}),jsxs(Tooltip$1,{children:[jsx(TooltipTrigger,{asChild:!0,children:jsx(Button,{className:c?"fk-ml-1.5":"fk-ml-auto",onClick:()=>{let i=p.current;c?i==null||i.expand():i==null||i.collapse();},size:"icon",variant:"ghost",children:c?jsxs(Fragment,{children:[jsx(ChevronsRight,{className:"fk-w-4 fk-h-4"}),jsx("span",{className:"fk-sr-only",children:"Expand"})]}):jsxs(Fragment,{children:[jsx(ChevronsLeft,{className:"fk-w-4 fk-h-4"}),jsx("span",{className:"fk-sr-only",children:"Collapse"})]})})}),jsx(TooltipContent,{children:c?"Expand":"Collapse"})]})]}),c?null:jsx(Separator,{}),s==null?void 0:s.plugins.map(i=>jsx(TabsContent,{className:`fk-flex fk-w-full fk-max-h-full fk-mt-0 ${c?"fk-hidden":""}`,value:i.title,children:jsxs(ScrollArea,{className:"fk-flex fk-w-full fk-max-h-full fk-overflow-auto fk-px-6 fk-pt-3 fk-pb-6 fk-mb-3",children:[jsx(i.content,{}),jsx(ScrollBar,{orientation:"horizontal"})]})},i.title))]})})}),jsx(ResizableHandle,{className:"hover:fk-bg-blue-500 fk-transition-colors",withHandle:!0}),jsx(ResizablePanel,{className:"fk-bg-muted",defaultSize:48,children:jsxs("div",{className:"fk-flex fk-flex-col fk-h-full",children:[jsx("div",{className:"fk-flex fk-items-center fk-py-1 fk-px-4 fk-bg-background",children:!t.disableTabs&&jsx(Tabs$1,{"aria-label":"Select active operation",className:"!fk-p-1 fk-bg-muted fk-rounded-md",onReorder:Te,values:a.tabs,children:a.tabs.length>0&&jsxs(Fragment,{children:[a.tabs.map((i,n)=>jsxs(Tab,{className:"fk-bg-background",isActive:n===a.activeTabIndex,value:i,children:[jsx(Tab.Button,{"aria-controls":"graphiql-session",id:`${w}${n.toString()}`,onClick:xe,children:i.title}),jsx(Tab.Close,{onClick:Pe})]},i.id)),Ne]})})}),jsx("div",{role:"tabpanel",id:"graphiql-session",className:"graphiql-session","aria-labelledby":`${w}${a.activeTabIndex}`,children:jsxs("div",{className:`graphiql-editors${a.tabs.length===1?" full-height":""}`,children:[jsx("div",{ref:d.firstRef,children:jsxs("section",{className:"graphiql-query-editor","aria-label":"Query Editor",children:[jsx(QueryEditor,{editorTheme:t.editorTheme,keyMap:t.keyMap,onCopyQuery:t.onCopyQuery,onEdit:t.onEditQuery,readOnly:t.readOnly}),jsxs("div",{className:"graphiql-toolbar",role:"toolbar","aria-label":"Editor Commands",children:[jsx(ExecuteButton,{}),D]})]})}),jsx("div",{ref:d.dragBarRef,children:jsxs("div",{className:"graphiql-editor-tools",children:[jsx(UnStyledButton,{type:"button",className:y==="variables"&&d.hiddenElement!=="second"?"active":"",onClick:Y,"data-name":"variables",children:"Variables"}),l&&jsx(UnStyledButton,{type:"button",className:y==="headers"&&d.hiddenElement!=="second"?"active":"",onClick:Y,"data-name":"headers",children:"Headers"}),jsx(Tooltip,{label:d.hiddenElement==="second"?"Show editor tools":"Hide editor tools",children:jsx(UnStyledButton,{type:"button",onClick:ke,"aria-label":d.hiddenElement==="second"?"Show editor tools":"Hide editor tools",className:"graphiql-toggle-editor-tools",children:d.hiddenElement==="second"?jsx(ChevronUpIcon,{className:"graphiql-chevron-icon","aria-hidden":"true"}):jsx(ChevronDownIcon,{className:"graphiql-chevron-icon","aria-hidden":"true"})})})]})}),jsxs("section",{className:"graphiql-editor-tool","aria-label":y==="variables"?"Variables":"Headers",children:[jsx(VariableEditor,{editorTheme:t.editorTheme,isHidden:y!=="variables",keyMap:t.keyMap,onEdit:t.onEditVariables,readOnly:t.readOnly}),l&&jsx(HeaderEditor,{editorTheme:t.editorTheme,isHidden:y!=="headers",keyMap:t.keyMap,onEdit:t.onEditHeaders,readOnly:t.readOnly})]})]})})]})}),jsx(ResizableHandle,{className:"hover:fk-bg-blue-500 fk-transition-colors",withHandle:!0}),jsx(ResizablePanel,{className:"fk-p-3 fk-relative fk-z-50",defaultSize:30,children:jsxs("div",{className:"graphiql-response fk-h-full",children:[r.isFetching?jsx(Spinner,{}):null,jsx(ResponseEditor,{editorTheme:t.editorTheme,responseTooltip:t.responseTooltip,keyMap:t.keyMap}),F]})})]}),jsxs(Dialog,{open:L==="short-keys",onOpenChange:Ee,children:[jsxs("div",{className:"graphiql-dialog-header",children:[jsx(Dialog.Title,{className:"graphiql-dialog-title",children:"Short Keys"}),jsx(Dialog.Close,{})]}),jsx("div",{className:"graphiql-dialog-section",children:jsx(kt,{keyMap:t.keyMap||"sublime"})})]}),jsxs(Dialog,{open:L==="settings",onOpenChange:Ce,children:[jsxs("div",{className:"graphiql-dialog-header",children:[jsx(Dialog.Title,{className:"graphiql-dialog-title",children:"Settings"}),jsx(Dialog.Close,{})]}),t.showPersistHeadersSettings?jsxs("div",{className:"graphiql-dialog-section",children:[jsxs("div",{children:[jsx("div",{className:"graphiql-dialog-section-title",children:"Persist headers"}),jsxs("div",{className:"graphiql-dialog-section-caption",children:["Save headers upon reloading."," ",jsx("span",{className:"graphiql-warning-text",children:"Only enable if you trust this device."})]})]}),jsxs(ButtonGroup,{children:[jsx(Button$1,{type:"button",id:"enable-persist-headers",className:a.shouldPersistHeaders?"active":"","data-value":"true",onClick:U,children:"On"}),jsx(Button$1,{type:"button",id:"disable-persist-headers",className:a.shouldPersistHeaders?"":"active",onClick:U,children:"Off"})]})]}):null,!b&&jsxs("div",{className:"graphiql-dialog-section",children:[jsxs("div",{children:[jsx("div",{className:"graphiql-dialog-section-title",children:"Theme"}),jsx("div",{className:"graphiql-dialog-section-caption",children:"Adjust how the interface appears."})]}),jsxs(ButtonGroup,{children:[jsx(Button$1,{type:"button",className:S===null?"active":"",onClick:v,children:"System"}),jsx(Button$1,{type:"button",className:S==="light"?"active":"","data-theme":"light",onClick:v,children:"Light"}),jsx(Button$1,{type:"button",className:S==="dark"?"active":"","data-theme":"dark",onClick:v,children:"Dark"})]})]}),u?jsxs("div",{className:"graphiql-dialog-section",children:[jsxs("div",{children:[jsx("div",{className:"graphiql-dialog-section-title",children:"Clear storage"}),jsx("div",{className:"graphiql-dialog-section-caption",children:"Remove all locally stored data and start fresh."})]}),jsx(Button$1,{type:"button",state:P||void 0,disabled:P==="success",onClick:H,children:{success:"Cleared data",error:"Failed"}[P]||"Clear data"})]}):null]})]})})}var X=isMacOs?"\u2318":"Ctrl",vt=Object.entries({"Search in editor":[X,"F"],"Search in documentation":[X,"K"],"Execute query":[X,"Enter"],"Prettify editors":["Ctrl","Shift","P"],"Merge fragments definitions into operation definition":["Ctrl","Shift","M"],"Copy query":["Ctrl","Shift","C"],"Re-fetch schema using introspection":["Ctrl","Shift","R"]});function kt({keyMap:t}){return jsxs("div",{children:[jsxs("table",{className:"graphiql-table",children:[jsx("thead",{children:jsxs("tr",{children:[jsx("th",{children:"Short Key"}),jsx("th",{children:"Function"})]})}),jsx("tbody",{children:vt.map(([l,a])=>jsxs("tr",{children:[jsx("td",{children:a.map((r,f,u)=>jsxs(Fragment$1,{children:[jsx("code",{className:"graphiql-key",children:r}),f!==u.length-1&&" + "]},r))}),jsx("td",{children:l})]},l))})]}),jsxs("p",{children:["The editors use"," ",jsx("a",{href:"https://codemirror.net/5/doc/manual.html#keymaps",target:"_blank",rel:"noopener noreferrer",children:"CodeMirror Key Maps"})," ","that add more short keys. This instance of Graph",jsx("em",{children:"i"}),"QL uses ",jsx("code",{children:t}),"."]})]})}function pe(t){return jsx(Fragment,{children:t.children})}pe.displayName="GraphiQLToolbar";function be(t){return jsx("div",{className:"graphiql-footer",children:t.children})}be.displayName="GraphiQLFooter";function fe(t,l){var a;return (a=t==null?void 0:t.type)!=null&&a.displayName&&t.type.displayName===l.displayName?!0:t.type===l}function ge(){let{currentProjectId:t}=useConfig(),l=`https://${t}.api.flexkit.io/graphql`,a=useMemo(()=>createGraphiQLFetcher({url:l}),[l]);return jsx(N,{fetcher:a})}function Jt(){return {name:"flexkit.explorer",contributes:{apps:[{name:"explorer",icon:jsx(SquarePlay,{strokeWidth:1.5}),title:"Explorer",component:jsx(ge,{}),routes:[]}]}}}

export { Jt as Explorer };
