import { SquarePlay, ChevronsRight, ChevronsLeft } from 'lucide-react';
import { useMemo, useState, useRef, useEffect, Children, useCallback, Fragment as Fragment$1 } from 'react';
import { createGraphiQLFetcher } from '@graphiql/toolkit';
import { GraphiQLProvider, useEditorContext, useExecutionContext, useSchemaContext, useStorageContext, usePluginContext, useCopyQuery, useMergeQuery, usePrettifyEditors, useTheme, useDragResize, ToolbarButton, PrettifyIcon, MergeIcon, CopyIcon, Tooltip, UnStyledButton, PlusIcon, Tabs as Tabs$1, Tab, QueryEditor, ExecuteButton, ChevronUpIcon, ChevronDownIcon, VariableEditor, HeaderEditor, Spinner, ResponseEditor, Dialog, ButtonGroup, Button as Button$1, isMacOs } from '@graphiql/react';
import { ResizablePanelGroup, ResizablePanel, Tabs, TabsList, TabsTrigger, Tooltip as Tooltip$1, TooltipTrigger, Button, TooltipContent, Separator, TabsContent, ScrollArea, ScrollBar, ResizableHandle } from '@flexkit/studio';
import { jsx, Fragment, jsxs } from 'react/jsx-runtime';
import '@graphiql/react/dist/style.css';

var qe=Object.defineProperty;var B=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var le=(t,l,a)=>l in t?qe(t,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[l]=a,ne=(t,l)=>{for(var a in l||(l={}))se.call(l,a)&&le(t,a,l[a]);if(B)for(var a of B(l))re.call(l,a)&&le(t,a,l[a]);return t};var de=(t,l)=>{var a={};for(var s in t)se.call(t,s)&&l.indexOf(s)<0&&(a[s]=t[s]);if(t!=null&&B)for(var s of B(t))l.indexOf(s)<0&&re.call(t,s)&&(a[s]=t[s]);return a};var ce=(t,l,a)=>new Promise((s,f)=>{var u=h=>{try{c(a.next(h));}catch(p){f(p);}},r=h=>{try{c(a.throw(h));}catch(p){f(p);}},c=h=>h.done?s(h.value):Promise.resolve(h.value).then(u,r);c((a=a.apply(t,l)).next());});function N(U){var v=U,{dangerouslyAssumeSchemaIsValid:t,confirmCloseTab:l,defaultQuery:a,defaultTabs:s,externalFragments:f,fetcher:u,getDefaultFieldNames:r,headers:c,inputValueDeprecation:h,introspectionQueryName:p,maxHistoryLength:b,onEditOperationName:A,onSchemaChange:I,onTabChange:O,onTogglePluginVisibility:S,operationName:g,plugins:J,query:d,response:y,schema:z,schemaDescription:Q,shouldPersistHeaders:T,storage:P,validationRules:H,variables:M,visiblePlugin:D,defaultHeaders:F}=v,x=de(v,["dangerouslyAssumeSchemaIsValid","confirmCloseTab","defaultQuery","defaultTabs","externalFragments","fetcher","getDefaultFieldNames","headers","inputValueDeprecation","introspectionQueryName","maxHistoryLength","onEditOperationName","onSchemaChange","onTabChange","onTogglePluginVisibility","operationName","plugins","query","response","schema","schemaDescription","shouldPersistHeaders","storage","validationRules","variables","visiblePlugin","defaultHeaders"]);var R;if(typeof u!="function")throw new TypeError("The `GraphiQL` component requires a `fetcher` function to be passed as prop.");return jsx(GraphiQLProvider,{getDefaultFieldNames:r,dangerouslyAssumeSchemaIsValid:t,defaultQuery:a,defaultHeaders:F,defaultTabs:s,externalFragments:f,fetcher:u,headers:c,inputValueDeprecation:h,introspectionQueryName:p,maxHistoryLength:b,onEditOperationName:A,onSchemaChange:I,onTabChange:O,onTogglePluginVisibility:S,plugins:J,visiblePlugin:D,operationName:g,query:d,response:y,schema:z,schemaDescription:Q,shouldPersistHeaders:T,storage:P,validationRules:H,variables:M,children:jsx(Tt,ne({confirmCloseTab:l,showPersistHeadersSettings:T!==!1,disableTabs:(R=x.disableTabs)!=null?R:!1,forcedTheme:x.forcedTheme},x))})}N.Toolbar=be;N.Footer=ge;var yt=["light","dark","system"],w="graphiql-session-tab-";function Tt(t){var ee,te,ae,ie;let l=(ee=t.isHeadersEditorEnabled)!=null?ee:!0,a=useEditorContext({nonNull:!0}),s=useExecutionContext({nonNull:!0}),f=useSchemaContext({nonNull:!0}),u=useStorageContext(),r=usePluginContext(),[c,h]=useState(!1),p=useRef(null),b=useMemo(()=>t.forcedTheme&&yt.includes(t.forcedTheme)?t.forcedTheme:void 0,[t.forcedTheme]),A=useCopyQuery({onCopyQuery:t.onCopyQuery}),I=useMergeQuery(),O=usePrettifyEditors(),{theme:S,setTheme:g}=useTheme(t.defaultTheme);useEffect(()=>{b==="system"?g(null):(b==="light"||b==="dark")&&g(b);},[b,g]),useEffect(()=>{r==null||r.setVisiblePlugin(r.plugins[0]);},[r]);useDragResize({direction:"horizontal",storageKey:"editorFlex"});let d=useDragResize({defaultSizeRelation:3,direction:"vertical",initiallyHidden:(()=>{if(!(t.defaultEditorToolsVisibility==="variables"||t.defaultEditorToolsVisibility==="headers"))return typeof t.defaultEditorToolsVisibility=="boolean"?t.defaultEditorToolsVisibility?void 0:"second":a.initialVariables||a.initialHeaders?void 0:"second"})(),sizeThresholdSecond:60,storageKey:"secondaryEditorFlex"}),[y,z]=useState(()=>t.defaultEditorToolsVisibility==="variables"||t.defaultEditorToolsVisibility==="headers"?t.defaultEditorToolsVisibility:!a.initialVariables&&a.initialHeaders&&l?"headers":"variables"),[Q,T]=useState(null),[P,H]=useState(null),M=Children.toArray(t.children),D=(ie=M.find(i=>pe(i,N.Toolbar)))!=null?ie:jsxs(Fragment,{children:[jsx(ToolbarButton,{onClick:O,label:"Prettify query (Shift-Ctrl-P)",children:jsx(PrettifyIcon,{className:"fk-w-8 fk-h-8 fk-block","aria-hidden":"true"})}),jsx(ToolbarButton,{onClick:I,label:"Merge fragments into query (Shift-Ctrl-M)",children:jsx(MergeIcon,{className:"graphiql-toolbar-icon","aria-hidden":"true"})}),jsx(ToolbarButton,{onClick:A,label:"Copy query (Shift-Ctrl-C)",children:jsx(CopyIcon,{className:"graphiql-toolbar-icon","aria-hidden":"true"})}),(te=t.toolbar)==null?void 0:te.additionalContent,((ae=t.toolbar)==null?void 0:ae.additionalComponent)&&jsx(t.toolbar.additionalComponent,{})]}),F=M.find(i=>pe(i,N.Footer)),x=useCallback(()=>{try{u==null||u.clear(),H("success");}catch(i){H("error");}},[u]),U=useCallback(i=>{a.setShouldPersistHeaders(i.currentTarget.dataset.value==="true");},[a]),v=useCallback(i=>{let n=i.currentTarget.dataset.theme;g(n||null);},[g]),R=a.addTab;f.introspect;let ve=a.moveTab;useCallback(i=>{T(i.currentTarget.dataset.value);},[]);let ke=useCallback(i=>{var oe;let n=r,k=Number(i.currentTarget.dataset.index);if(!n)return;let q=(oe=n.plugins.find((qt,xe)=>k===xe))!=null?oe:null;if(q===n.visiblePlugin){n.setVisiblePlugin(null);return}n.setVisiblePlugin(q);},[r]),Y=useCallback(i=>{d.hiddenElement==="second"&&d.setHiddenElement(null),z(i.currentTarget.dataset.name);},[d]),Ee=useCallback(()=>{d.setHiddenElement(d.hiddenElement==="second"?null:"second");},[d]),Ce=useCallback(i=>{i||T(null);},[]),Ne=useCallback(i=>{i||(T(null),H(null));},[]),Z=jsx(Tooltip,{label:"Add tab",children:jsx(UnStyledButton,{type:"button",className:"graphiql-tab-add",onClick:R,"aria-label":"Add tab",children:jsx(PlusIcon,{"aria-hidden":"true"})})}),Se=t.className?` ${t.className}`:"",K=t.confirmCloseTab,Pe=useCallback(i=>ce(this,null,function*(){let n=i.currentTarget.previousSibling,k=Number(n.id.replace(w,""));(!K||(yield K(k)))&&(a.activeTabIndex===k&&s.stop(),a.closeTab(k));}),[K,a,s]),He=useCallback(i=>{let n=Number(i.currentTarget.id.replace(w,""));s.stop(),a.changeTab(n);},[a,s]);return jsx(Tooltip.Provider,{children:jsxs("div",{className:`graphiql-container${Se}`,children:[jsxs(ResizablePanelGroup,{autoSaveId:"explorer",direction:"horizontal",className:"fk-h-full fk-max-h-full",children:[jsx(ResizablePanel,{collapsible:!0,collapsedSize:3,minSize:10,onCollapse:()=>{h(!0);},onExpand:()=>{h(!1);},ref:p,children:jsx("div",{className:"fk-flex fk-w-full fk-h-full fk-pb-6",children:jsxs(Tabs,{className:"fk-w-full",defaultValue:r==null?void 0:r.plugins[0].title,children:[jsxs("div",{className:`fk-flex fk-items-center fk-py-1 ${c?"":"fk-px-4"}`,children:[jsx(TabsList,{className:c?"fk-hidden":"",children:r==null?void 0:r.plugins.map((i,n)=>{let q=`${i===r.visiblePlugin?"Hide":"Show"} ${i.title}`;return jsx(TabsTrigger,{"aria-label":q,className:"fk-text-muted-foreground","data-index":n,onClick:ke,value:i.title,children:jsx(i.icon,{"aria-hidden":"true"})},i.title)})}),jsxs(Tooltip$1,{children:[jsx(TooltipTrigger,{asChild:!0,children:jsx(Button,{className:c?"fk-ml-1.5":"fk-ml-auto",onClick:()=>{let i=p.current;c?i==null||i.expand():i==null||i.collapse();},size:"icon",variant:"ghost",children:c?jsxs(Fragment,{children:[jsx(ChevronsRight,{className:"fk-w-4 fk-h-4"}),jsx("span",{className:"fk-sr-only",children:"Expand"})]}):jsxs(Fragment,{children:[jsx(ChevronsLeft,{className:"fk-w-4 fk-h-4"}),jsx("span",{className:"fk-sr-only",children:"Collapse"})]})})}),jsx(TooltipContent,{children:c?"Expand":"Collapse"})]})]}),c?null:jsx(Separator,{}),r==null?void 0:r.plugins.map(i=>jsx(TabsContent,{className:`fk-flex fk-w-full fk-max-h-full fk-mt-0 ${c?"fk-hidden":""}`,value:i.title,children:jsxs(ScrollArea,{className:"fk-flex fk-w-full fk-max-h-full fk-overflow-auto fk-px-6 fk-pt-3 fk-pb-6 fk-mb-3",children:[jsx(i.content,{}),jsx(ScrollBar,{orientation:"horizontal"})]})},i.title))]})})}),jsx(ResizableHandle,{className:"hover:fk-bg-blue-500 fk-transition-colors",withHandle:!0}),jsx(ResizablePanel,{className:"fk-p-3 fk-bg-muted",defaultSize:48,children:jsx("div",{className:"graphiql-main",children:jsxs("div",{className:"graphiql-sessions",children:[jsxs("div",{className:"graphiql-session-header",children:[!t.disableTabs&&jsx(Tabs$1,{values:a.tabs,onReorder:ve,"aria-label":"Select active operation",children:a.tabs.length>1&&jsxs(Fragment,{children:[a.tabs.map((i,n)=>jsxs(Tab,{value:i,isActive:n===a.activeTabIndex,children:[jsx(Tab.Button,{"aria-controls":"graphiql-session",id:`${w}${n}`,onClick:He,children:i.title}),jsx(Tab.Close,{onClick:Pe})]},i.id)),Z]})}),jsx("div",{className:"graphiql-session-header-right",children:a.tabs.length===1&&Z})]}),jsx("div",{role:"tabpanel",id:"graphiql-session",className:"graphiql-session","aria-labelledby":`${w}${a.activeTabIndex}`,children:jsxs("div",{className:`graphiql-editors${a.tabs.length===1?" full-height":""}`,children:[jsx("div",{ref:d.firstRef,children:jsxs("section",{className:"graphiql-query-editor","aria-label":"Query Editor",children:[jsx(QueryEditor,{editorTheme:t.editorTheme,keyMap:t.keyMap,onCopyQuery:t.onCopyQuery,onEdit:t.onEditQuery,readOnly:t.readOnly}),jsxs("div",{className:"graphiql-toolbar",role:"toolbar","aria-label":"Editor Commands",children:[jsx(ExecuteButton,{}),D]})]})}),jsx("div",{ref:d.dragBarRef,children:jsxs("div",{className:"graphiql-editor-tools",children:[jsx(UnStyledButton,{type:"button",className:y==="variables"&&d.hiddenElement!=="second"?"active":"",onClick:Y,"data-name":"variables",children:"Variables"}),l&&jsx(UnStyledButton,{type:"button",className:y==="headers"&&d.hiddenElement!=="second"?"active":"",onClick:Y,"data-name":"headers",children:"Headers"}),jsx(Tooltip,{label:d.hiddenElement==="second"?"Show editor tools":"Hide editor tools",children:jsx(UnStyledButton,{type:"button",onClick:Ee,"aria-label":d.hiddenElement==="second"?"Show editor tools":"Hide editor tools",className:"graphiql-toggle-editor-tools",children:d.hiddenElement==="second"?jsx(ChevronUpIcon,{className:"graphiql-chevron-icon","aria-hidden":"true"}):jsx(ChevronDownIcon,{className:"graphiql-chevron-icon","aria-hidden":"true"})})})]})}),jsxs("section",{className:"graphiql-editor-tool","aria-label":y==="variables"?"Variables":"Headers",children:[jsx(VariableEditor,{editorTheme:t.editorTheme,isHidden:y!=="variables",keyMap:t.keyMap,onEdit:t.onEditVariables,readOnly:t.readOnly}),l&&jsx(HeaderEditor,{editorTheme:t.editorTheme,isHidden:y!=="headers",keyMap:t.keyMap,onEdit:t.onEditHeaders,readOnly:t.readOnly})]})]})})]})})}),jsx(ResizableHandle,{className:"hover:fk-bg-blue-500 fk-transition-colors",withHandle:!0}),jsx(ResizablePanel,{className:"fk-p-3 fk-relative fk-z-50",defaultSize:30,children:jsxs("div",{className:"graphiql-response fk-h-full",children:[s.isFetching?jsx(Spinner,{}):null,jsx(ResponseEditor,{editorTheme:t.editorTheme,responseTooltip:t.responseTooltip,keyMap:t.keyMap}),F]})})]}),jsxs(Dialog,{open:Q==="short-keys",onOpenChange:Ce,children:[jsxs("div",{className:"graphiql-dialog-header",children:[jsx(Dialog.Title,{className:"graphiql-dialog-title",children:"Short Keys"}),jsx(Dialog.Close,{})]}),jsx("div",{className:"graphiql-dialog-section",children:jsx(kt,{keyMap:t.keyMap||"sublime"})})]}),jsxs(Dialog,{open:Q==="settings",onOpenChange:Ne,children:[jsxs("div",{className:"graphiql-dialog-header",children:[jsx(Dialog.Title,{className:"graphiql-dialog-title",children:"Settings"}),jsx(Dialog.Close,{})]}),t.showPersistHeadersSettings?jsxs("div",{className:"graphiql-dialog-section",children:[jsxs("div",{children:[jsx("div",{className:"graphiql-dialog-section-title",children:"Persist headers"}),jsxs("div",{className:"graphiql-dialog-section-caption",children:["Save headers upon reloading."," ",jsx("span",{className:"graphiql-warning-text",children:"Only enable if you trust this device."})]})]}),jsxs(ButtonGroup,{children:[jsx(Button$1,{type:"button",id:"enable-persist-headers",className:a.shouldPersistHeaders?"active":"","data-value":"true",onClick:U,children:"On"}),jsx(Button$1,{type:"button",id:"disable-persist-headers",className:a.shouldPersistHeaders?"":"active",onClick:U,children:"Off"})]})]}):null,!b&&jsxs("div",{className:"graphiql-dialog-section",children:[jsxs("div",{children:[jsx("div",{className:"graphiql-dialog-section-title",children:"Theme"}),jsx("div",{className:"graphiql-dialog-section-caption",children:"Adjust how the interface appears."})]}),jsxs(ButtonGroup,{children:[jsx(Button$1,{type:"button",className:S===null?"active":"",onClick:v,children:"System"}),jsx(Button$1,{type:"button",className:S==="light"?"active":"","data-theme":"light",onClick:v,children:"Light"}),jsx(Button$1,{type:"button",className:S==="dark"?"active":"","data-theme":"dark",onClick:v,children:"Dark"})]})]}),u?jsxs("div",{className:"graphiql-dialog-section",children:[jsxs("div",{children:[jsx("div",{className:"graphiql-dialog-section-title",children:"Clear storage"}),jsx("div",{className:"graphiql-dialog-section-caption",children:"Remove all locally stored data and start fresh."})]}),jsx(Button$1,{type:"button",state:P||void 0,disabled:P==="success",onClick:x,children:{success:"Cleared data",error:"Failed"}[P]||"Clear data"})]}):null]})]})})}var X=isMacOs?"\u2318":"Ctrl",vt=Object.entries({"Search in editor":[X,"F"],"Search in documentation":[X,"K"],"Execute query":[X,"Enter"],"Prettify editors":["Ctrl","Shift","P"],"Merge fragments definitions into operation definition":["Ctrl","Shift","M"],"Copy query":["Ctrl","Shift","C"],"Re-fetch schema using introspection":["Ctrl","Shift","R"]});function kt({keyMap:t}){return jsxs("div",{children:[jsxs("table",{className:"graphiql-table",children:[jsx("thead",{children:jsxs("tr",{children:[jsx("th",{children:"Short Key"}),jsx("th",{children:"Function"})]})}),jsx("tbody",{children:vt.map(([l,a])=>jsxs("tr",{children:[jsx("td",{children:a.map((s,f,u)=>jsxs(Fragment$1,{children:[jsx("code",{className:"graphiql-key",children:s}),f!==u.length-1&&" + "]},s))}),jsx("td",{children:l})]},l))})]}),jsxs("p",{children:["The editors use"," ",jsx("a",{href:"https://codemirror.net/5/doc/manual.html#keymaps",target:"_blank",rel:"noopener noreferrer",children:"CodeMirror Key Maps"})," ","that add more short keys. This instance of Graph",jsx("em",{children:"i"}),"QL uses ",jsx("code",{children:t}),"."]})]})}function be(t){return jsx(Fragment,{children:t.children})}be.displayName="GraphiQLToolbar";function ge(t){return jsx("div",{className:"graphiql-footer",children:t.children})}ge.displayName="GraphiQLFooter";function pe(t,l){var a;return (a=t==null?void 0:t.type)!=null&&a.displayName&&t.type.displayName===l.displayName?!0:t.type===l}function ye(){let t="https://abcdefghij.api.flexkit.io/graphql",l=useMemo(()=>createGraphiQLFetcher({url:t}),[t]);return jsx(N,{fetcher:l})}function jt(){return {name:"flexkit.explorer",contributes:{apps:[{name:"explorer",icon:jsx(SquarePlay,{strokeWidth:1.5}),title:"Explorer",component:jsx(ye,{}),routes:[]}]}}}

export { jt as Explorer };
